# Halt configuration for Claude Code on Linux
#
# Restricts Claude Code to Anthropic's API and common developer package
# registries. Uses Landlock LSM for filesystem isolation (kernel 5.19+)
# and a network namespace + proxy for network filtering.
#
# Usage:
#   halt run --config configs/linux/claude.toml -- claude
#
# Tighter usage (ignore global/project halt.toml, use only this file):
#   halt run --no-config --config configs/linux/claude.toml -- claude
#
# FILESYSTEM NOTE: On Linux, halt uses Landlock LSM which only grants access
# to paths declared in [[sandbox.mounts]] (not [sandbox.paths]). The paths
# below must be absolute — tilde (~) is not expanded in mounts.
# Update the paths below to match your home directory.
#
# CREDENTIALS NOTE: Claude Code stores OAuth tokens via libsecret (GNOME
# keyring). Granting the D-Bus socket inside Landlock is complex; the
# simplest workaround is to pass your API key via environment variable:
#
#   halt run --config configs/linux/claude.toml --env ANTHROPIC_API_KEY -- claude
#
# or set ANTHROPIC_API_KEY in your shell and it will be forwarded.

[sandbox]
network = { mode = "proxy_only" }

# Claude Code needs read-write access to its session/config/log directories.
# Replace /home/YOUR_USER with your actual home directory path.

[[sandbox.mounts]]
path = "/home/YOUR_USER/.claude"
readonly = false

[[sandbox.mounts]]
path = "/home/YOUR_USER/.claude.json"
readonly = false

[[sandbox.mounts]]
path = "/home/YOUR_USER/.local/share/claude"
readonly = false

[[sandbox.mounts]]
path = "/home/YOUR_USER/.gitconfig"
readonly = true

[[sandbox.mounts]]
path = "/home/YOUR_USER/.config/git"
readonly = true

[proxy]
domain_allowlist = [
  # Anthropic API and telemetry
  "api.anthropic.com",
  "statsig.anthropic.com",
  "sentry.io",

  # GitHub — reading repos, cloning, downloading release assets
  "github.com",
  "*.github.com",
  "raw.githubusercontent.com",
  "objects.githubusercontent.com",
  "codeload.github.com",

  # npm (JavaScript / Node.js)
  "registry.npmjs.org",
  "*.npmjs.org",

  # PyPI (Python)
  "pypi.org",
  "files.pythonhosted.org",

  # crates.io (Rust)
  "crates.io",
  "static.crates.io",
  "index.crates.io",

  # RubyGems
  "rubygems.org",

  # Go module proxy
  "proxy.golang.org",
  "sum.golang.org",
  "storage.googleapis.com",
]
