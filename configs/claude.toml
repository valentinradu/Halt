# Halt configuration for Claude Code
#
# Restricts Claude Code to Anthropic's API and common developer package
# registries. Filesystem access is limited to your project directory (the
# directory you run halt from) plus the system defaults.
#
# Usage:
#   halt run --config configs/claude.toml -- claude
#
# Tighter usage (ignore global/project halt.toml, use only this file):
#   halt run --no-config --config configs/claude.toml -- claude
#
# NOTE: When running for the first time or after a token refresh, Claude Code
# may need to access the macOS Keychain to retrieve its OAuth token. If you
# see "Not logged in", pass your API key directly:
#
#   halt run --config configs/claude.toml --env ANTHROPIC_API_KEY -- claude
#
# Alternatively, set ANTHROPIC_API_KEY in your environment and it will be
# passed through automatically.

[sandbox]
network = { mode = "proxy_only" }

[sandbox.paths]
# Allow listing the home directory so Node.js can discover config paths
traversal = ["~"]

read = [
  # Claude Code installation and runtime data
  "~/.local/share/claude",
  # macOS per-user system files read by most Node.js processes
  "~/.CFUserTextEncoding",
  "~/Library/Preferences",
  "~/Library/Application Support/com.apple.TCC",
  # Git config (Claude reads these when running git commands)
  "~/.gitconfig",
  "~/.config/git",
]
read_write = [
  # Claude Code writes session data, debug logs, todos, and project history here
  "~/.claude",
  # Glob: covers .claude.json, .claude.json.lock, .claude.json.tmp.PID.TS, etc.
  "~/.claude.json*",
  # macOS Keychain — Security framework needs read+write access for OAuth token retrieval
  "~/Library/Keychains",
]

[proxy]
domain_allowlist = [
  # Anthropic API and telemetry
  "api.anthropic.com",
  "statsig.anthropic.com",
  "sentry.io",

  # GitHub — reading repos, cloning, downloading release assets
  "github.com",
  "*.github.com",
  "raw.githubusercontent.com",
  "objects.githubusercontent.com",
  "codeload.github.com",

  # npm (JavaScript / Node.js)
  "registry.npmjs.org",
  "*.npmjs.org",

  # PyPI (Python)
  "pypi.org",
  "files.pythonhosted.org",

  # crates.io (Rust)
  "crates.io",
  "static.crates.io",
  "index.crates.io",

  # RubyGems
  "rubygems.org",

  # Go module proxy
  "proxy.golang.org",
  "sum.golang.org",
  "storage.googleapis.com",
]
